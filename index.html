<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم ثبت خرید - نمایش هم به مدیر و هم به کاربر</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- استفاده از CDN مطمئن‌تر برای XLSX -->
    <!-- Supabase Client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Font Awesome برای آیکون‌ها -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- SheetJS برای اکسل -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <sc ipt=src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></scr
        <!-- Supabase Client
        <sc ipt=src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></scr
pt>
</h
ad>
<b
         div c=ass="notificat on= id="notification"></
    
        <!-- مدال پیش‌نمایش چاپ
         div c=ass="print-preview-mo al= id="printPreviewMod
             div c=ass="print-preview-conte
                 div c=ass="print-preview-head
                    پیش‌نمایش چاپ چاپ<
                    <bu ton c=ass="close-prev ew= id="closePreviewBtn">&times;</but
                </
                 div c=ass="print-preview-b dy= id="printPreviewBo
                    <!-- محتوای چاپ اینجا قرار می‌گیرد
                </
                 div c=ass="action-butto
                    <bu to= id="print tn" c=ass="btn btn-print ><i c=ass="fas fa-print"> چاپ چاپ</but
                    <bu to= id="closeModal tn" c=ass="btn btn-logoبستنبستن</but
                </
            </
        </
    
         div c=ass="contain
            <hea
                <h ><i c=ass="fas fa-shopping-cart"> سیستم مدیریت ثبت خریدخرید<
               سامانه ثبت خرید کالا - نمایش به مدیر و کاربر - با قابلیت خروجی اکسل و چاپ چاپ
                <s all s=yle="opa: ty:; .7; font-: ze: 0.; em; margin: op: ; px; dis: ay: bloc
                    <i c=ass="fas fa-database"> پشتیبانی از پایگاه داده Supabase
                </sm
            </hea
        
             di= id="authSect on" c=ass="auth-contain
                 div c=ass="auth-b
                    <h2 c=ass="auth-titورود به سیستمیستم<
                     div c=ass="form-gro
                        <l bel=for="usernaنام کاربریربری</la
                        <i put =ype="t xt= id="usern me" placeho=der="نام کاربری خود را وارد کن
                    </
                     div c=ass="form-gro
                        <l bel=for="passwoکلمه عبورعبور</la
                        <i put =ype="passw rd= id="passw rd" placeho=der="کلمه عبور خود را وارد کن
                    </
                     div c=ass="form-gro
                        <l bel=for="roنقش کاربریربری</la
                        <se ec= id="ro
                            <op ion v=lue="usکاربر عادیعادی</opt
                            <op ion v=lue="admمدیر سیستمیستم</opt
                        </sel
                    </
                    <bu to= id="login tn" c=ass="b
                        < pa= id="loginTeورود به سیستمیستم</s
                        < pa= id="loginLoad ng" c=ass="loading hidden"></s
                    </but
                
                     div c=ass="info- ox" s=yle="margin: op: 25p
                        <i c=ass="fas fa-info-circle">
                        <
                            <strSILENTLENT</strong>
                           
                       ساخته شده توسط SILENT BELL
                        </
                    </
                </
            </
        
             di= id="appSect on" c=ass="hidd
                 div c=ass="user-in
                     div c=ass="user-detai
                         div c=ass="user-ava ar= id="userAvatUr">U</
                        <
                            <h= id="currentUserNaنام کاربراربر<
                            <= id="currentUserEmaایمیل کاربراربر
                        </
                        < pa= id="currentUserR le" c=ass="user-roنقش>نقش</s
                    </
                     div c=ass="tim
                        <i c=ass="far fa-clock"> 
                    زمان تا بروزرسانی جدول: ول: < pa= id="countdo24:00:000:00</s
                    </
                    <bu to= id="logout tn" c=ass="btn btn-logoخروج از سیستمیستم</but
                </
            
                 div c=ass="cont nt= id="userConte
                     div c=ass="ta
                         div c=ass="tab act ve" data=tab="addPurcha
                            <spa ><i c=ass="fas fa-plus-circle"> ثبت خرید جدیدجدید</s
                        </
                         div c=ass=" ab" data=tab="myPurchas
                            <spa ><i c=ass="fas fa-list"> خریدهای ثبت شده توسط منط من</s
                        </
                    </
                
                     div c=ass="tab-content act ve= id="addPurcha
                         div c=ass="form-contain
                            <h ><i c=ass="fas fa-plus-circle"> فرم ثبت خرید جدیدجدید<
                        <p style="margin-bottom: 20px; color: #666;">خریدهای شما هم برای خودتان و هم برای مدیر سیستم نمایش داده می‌شود.</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="itemName">نام کالا *</label>
                                <input type="text" id="itemName" placeholder="نام کالا را وارد کنید">
                            </div>
                            <div class="form-group">
                                <label for="buyerName">نام خریدار *</label>
                                <input type="text" id="buyerName" placeholder="نام خریدار را وارد کنید">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="itemPrice">قیمت (افغانی ) *</label>
                                <input type="number" id="itemPrice" placeholder="قیمت را وارد کنید" min="0">
                            </div>
                            <div class="form-group">
                                <label for="itemCategory">دسته‌بندی</label>
                                <select id="itemCategory">
                                    <option value="الکترونیک">الکترونیک</option>
                                    <option value="پوشاک">پوشاک</option>
                                    <option value="خواروبار">خواروبار</option>
                                    <option value="کالای دیجیتال">کالای دیجیتال</option>
                                    <option value="لوازم خانگی">لوازم خانگی</option>
                                    <option value="سایر">سایر</option>
                                </select>
                            </div>
                        </div>
                        <button id="submitPurchase" class="btn">
                            <span id="submitText">ثبت خرید</span>
                            <span id="submitLoading" class="loading hidden"></span>
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3><i class="fas fa-history"></i> آخرین خریدهای ثبت‌شده توسط شما</h3>
                            <div class="excel-actions">
                                <button id="exportUserRecentExcel" class="btn btn-excel">
                                    <i class="fas fa-file-excel"></i> خروجی اکسل خریدهای اخیر
                                </button>
                                <button id="printUserRecent" class="btn btn-print">
                                    <i class="fas fa-print"></i> چاپ خریدهای اخیر
                                </button>
                            </div>
                        </div>
                        <table id="recentPurchasesTable">
                            <thead>
                                <tr>
                                    <th>ردیف</th>
                                    <th>نام کالا</th>
                                    <th>نام خریدار</th>
                                    <th>قیمت (افغانی )</th>
                                    <th>دسته‌بندی</th>
                                    <th>تاریخ ثبت</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- داده‌ها توسط JavaScript پر می‌شود -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="myPurchases">
                    <div class="table-container">
                        <div class="table-header">
                            <h3><i class="fas fa-list"></i> تمام خریدهای ثبت‌شده توسط شما</h3>
                            <div class="excel-actions">
                                <button id="exportUserAllExcel" class="btn btn-excel">
                                    <i class="fas fa-file-excel"></i> خروجی اکسل تمام خریدهای من
                                </button>
                                <button id="printUserAll" class="btn btn-print">
                                    <i class="fas fa-print"></i> چاپ تمام خریدهای من
                                </button>
                            </div>
                        </div>
                        <p style="margin-bottom: 15px; color: #666; padding: 0 25px;">این خریدها هم برای شما و هم برای مدیر سیستم قابل مشاهده هستند.</p>
                        <table id="allPurchasesTable">
                            <thead>
                                <tr>
                                    <th>ردیف</th>
                                    <th>نام کالا</th>
                                    <th>نام خریدار</th>
                                    <th>قیمت (افغانی )</th>
                                    <th>دسته‌بندی</th>
                                    <th>تاریخ ثبت</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- داده‌ها توسط JavaScript پر می‌شود -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="content" id="adminContent">
                <div class="info-box">
                    <i class="fas fa-user-shield"></i>
                    <div>
                        <strong>پنل مدیریت سیستم</strong> - شما به عنوان مدیر سیستم می‌توانید تمامی خریدهای ثبت‌شده توسط کاربران را مشاهده کنید. داده‌های جدول هر 24 ساعت به‌طور خودکار بروزرسانی می‌شوند.
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-users"></i> لیست کاربران سیستم</h3>
                        <div class="excel-actions">
                            <button id="exportUsersExcel" class="btn btn-excel">
                                <i class="fas fa-file-excel"></i> خروجی اکسل کاربران
                            </button>
                            <button id="printUsers" class="btn btn-print">
                                <i class="fas fa-print"></i> چاپ لیست کاربران
                            </button>
                        </div>
                    </div>
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>ردیف</th>
                                <th>نام کاربری</th>
                                <th>نقش</th>
                                <th>ایمیل</th>
                                <th>وضعیت</th>
                                <th>تعداد خریدها</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- داده‌ها توسط JavaScript پر می‌شود -->
                        </tbody>
                    </table>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-shopping-bag"></i> تمام خریدهای ثبت‌شده توسط همه کاربران</h3>
                        <div class="excel-actions">
                            <button id="exportAllPurchasesExcel" class="btn btn-excel">
                                <i class="fas fa-file-excel"></i> خروجی اکسل تمام خریدها
                            </button>
                            <button id="printAllPurchases" class="btn btn-print">
                                <i class="fas fa-print"></i> چاپ تمام خریدها
                            </button>
                        </div>
                    </div>
                    <p style="margin-bottom: 15px; color: #666; padding: 0 25px;">این خریدها هم توسط کاربران و هم توسط شما (مدیر) قابل مشاهده هستند.</p>
                    <table id="allUsersPurchasesTable">
                        <thead>
                            <tr>
                                <th>ردیف</th>
                                <th>نام کالا</th>
                                <th>نام خریدار</th>
                                <th>کاربر ثبت‌کننده</th>
                                <th>قیمت (افغانی )</th>
                                <th>دسته‌بندی</th>
                                <th>تاریخ ثبت</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- داده‌ها توسط JavaScript پر می‌شود -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
